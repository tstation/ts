<% locals.setLayout('src/project/mobile/includes/layouts/base.ejs') -%>
<% locals.block('title', '타이어 쇼핑은 T\'Station.com') -%>

<%# Include %>
<%- locals.widget('src/project/mobile/includes/layouts/nav-bar.ejs', { pageTitle: '이벤트' }) %>
<div id="container" class="mypage">
    <!-- 02. 제목 -->
    <div class="event_tit">
        The Premium Rewards - SUV
        <span class="date">이벤트 기간 : 20.08.05  ~ 20.10.31</span>
    </div>
    <!-- //02. 제목  -->
    <!-- event list -->
    <input type="hidden" id="evtUrlAddr" value="">
    <input type="hidden" id="endEvtDisp" value="">
    <input type="hidden" id="isEvtDispBf" value="">

    <div class="event_detail">


<style>

.event-roulette-detail {width:100%;max-width:750px;}
.event-roulette-detail .video-section {
    float: none;
    clear: both;
    width: 100%;
    position: relative;
    padding-bottom: 56.25%;
    height: 0;
}
.event-roulette-detail #player { 
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

/* line 2279, src/project/mobile/assets/styles/layout.scss */
.event-roulette-detail .event-section .rotation-group {
    position: relative;
    text-align: center;
    padding-top: 80%;
}

.event-roulette-detail .event-section .rotation-group .rotation-panel {
    position: absolute;
    top: 6.87%;
    left: 15.334%;
    width: 69.6%;
    z-index: 3;
}

.event-roulette-detail .event-section .rotation-group .rotation-panel > img {
    display: block;
    width: 100%;
}

.event-roulette-detail .event-section .rotation-group .rotation-point {
    position: absolute;
    top: 2.505%;
    left: 46.934%;
    width: 7.334%;
    z-index: 4;
}

.event-roulette-detail .event-section .rotation-group .back-board {
    position: absolute;
    top: 5.42%;
    width: 78.239%;
    left: 50%;
    transform: translate(-50%);
    z-index: 2;
}

</style>



        <div class="event-roulette-detail">
            <div class="center-inner">
                
                <!-- 비디오 섹션 -->
                <div class="video-section">
                    <div id="player"></div>
                </div>
                <!-- //비디오 섹션 --> 
                <!-- 이벤트 섹션 -->
                <div>
                    <div class="event-section">
                        <div class="rotation-group">
                            <!-- <div class="dimmed" style="display:block; position: absolute; left:0; right:0; top:0; bottom:0; z-index: 999; background-color: rgba( 1, 1, 1, .5);"></div> -->
                            <div class="rotation-panel"><img src="https://po.tstation.com/upload/marketing/2020/20200602094302/panel.png" alt=""></div>
                            <span class="rotation-point"><img src="https://po.tstation.com/upload/marketing/2020/20200601172559/point.png" alt="" style="display:block;max-width:100%;"></span>
                            <div class="back-board"><img src="https://po.tstation.com/upload/marketing/2020/20200602160100/200608_familysale_page_roulette_shadow.png" alt=""></div>
                            <div class="inner-box top-round fake-bg"></div>
                        </div>
                        <div class="inner-box">
                            <button type="button" class="js-rotation-event" title="룰렛 돌리고 쿠폰 받기"><img src="https://po.tstation.com/upload/marketing/2020/20200610135933/event-brn.png" alt=""></button><!-- 20200610 이미지 변경 daesung -->
                        </div>
                    </div>

                    <div class="check-field">
                        <input type="checkbox" class="ip_c" id="eventPrivacyPolicy">
                        <label for="eventPrivacyPolicy">이벤트 참여를 위해 아래와 같이 개인정보를 수집 및 이용에 동의합니다.</label>
                    </div>
                </div>
                <!--// 이벤트 섹션 -->
                
                <script src="mc-static-root/js/common/jQueryRotateCompressed.js"></script>
                <script>
                // 2. This code loads the IFrame Player API code asynchronously.
                var tag = document.createElement('script');

                tag.src = "https://www.youtube.com/iframe_api";
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                // 3. This function creates an <iframe> (and YouTube player)
                //    after the API code downloads.
                var player;
                function onYouTubeIframeAPIReady() {
                    player = new YT.Player('player', {
                    // height: '100%',
                    // width: '100%',
                    videoId: 'sczYGgvr2ik',
                    playerVars: { 
                        // 'controls': 0, //컨트럴바 숨김
                        'fs': 0,  
                        'loop': 1,
                        'modestbranding': 1, //유튜브 로고숨김
                        'playsinline': 1 //IOS 인라인 제생
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                    });
                }
                function onPlayerReady(event) {
                    event.target.playVideo();
                    
                }
                var playerDone = false;
                var playerRoulette = false;
                var time = "5000"
                function onPlayerStateChange(event) {
                    if (event.data == YT.PlayerState.PLAYING && !playerDone) {
                        setTimeout(timeCheck, time); //* 시간체크
                    }
                }
                function timeCheck() {
                    alert('영상 봐')
                    $('.rotation-group').find('.dimmed').hide();
                    playerRoulette = true;
                }

                var eventRouletteAllCheck = false, // oTher && 개인정보  체크박스 체크 완료 시 =  true / default : false
                    eventPrivacyPolicyCheck = false, // 개인정보 체크 완료시 = true / default false
                    eventCompletedProductNames;   // 당첨 된 상품명 담는 변수

                var rouletteControl = {
                    eventProductData : ["모바일주유권 1만원","스타벅스 5천원 쿠폰", "타이터 3+1 쿠폰","타이어 20% 할인쿠폰","타이어 2+2 쿠폰"], // 상품명 정의
                    eventAttend : false, // 참여 여부 체크
                    preventDefault : false, // 이벤트 전파 막는 용
                    init : function () {
                        /* 처음 로드 될 시 처리할 이벤트 */
                    },
                    event : function (e) {
                        var $panel = $(".rotation-panel img"),
                            $animationActionAngle = (360 * 10); 
                        console.log(playerRoulette);
                        if( eventRouletteAllCheck && playerRoulette ){ // 전체 벨리데이션 체크 완료 시
                            if( rouletteControl.eventAttend ){ // 이미 룰렛을 돌렸을 경우
                                alert( "이미 ["+ eventCompletedProductNames +"]에 당첨되셨습니다. \n" + "본 이벤트는 1인 1회에 한하여 참여가 가능합니다."  );
                                return;
                            } else if ( rouletteControl.preventDefault){ // 룰렛을 돌리는 중 클릭 시 이벤트 전파 막기
                                // console.log("이미 이벤트에 참여 중입니다.");
                                return;
                            } else { // 처음 룰렛을 돌릴 때

                                $panel.rotate({
                                    angle:0,
                                    animateTo: $animationActionAngle + rouletteControl.randomNumber(0, 360),
                                    center: ["50%", "50%"],
                                    easing: $.easing.easeInOutElastic,
                                    duration:10000, 
                                    callback :function() {
                                        var $realRendomAngle = $(this).getRotateAngle() - $animationActionAngle;

                                        rouletteControl.productMatch( $realRendomAngle ); // 애니메이션을 제외한 실제 앵글 값 전달
                                        rouletteControl.eventCompleted();
                                    }
                                });

                                rouletteControl.preventDefault = true;
                            }
                        } else { // 개인정보 수집 및 이용 약관 동의 & 휴대폰 인증이 완료 되지 않을 때
                        	if(!eventPrivacyPolicyCheck){
                                alert("개인정보 수집 및 이용에 동의를 체크해 주세요."); 
                                return;
                            }
                            if(!playerRoulette){
                                alert("동영상을 보고오세요"); 
                                return;
                            }
                        }
                    },
                    randomNumber : function ($min, $max){ // 랜덤 확률 작업 영역.
                        return Math.floor(Math.random() * ($max - $min + 1)) + $min;
                    },
                    productMatch : function( $angle ) { // 상품 매치
                        var $n = parseInt($angle);
                        if($n > 0 && $n <= 72) {
                            eventCompletedProductNames = rouletteControl.eventProductData[0]
                        } else if($n > 72 && $n <= 144){
                            eventCompletedProductNames = rouletteControl.eventProductData[1]
                        } else if($n > 144 && $n <= 216){
                            eventCompletedProductNames = rouletteControl.eventProductData[2]
                        } else if($n > 216 && $n <= 288){
                            eventCompletedProductNames = rouletteControl.eventProductData[3]
                        } else if($n > 288 && $n <= 360){
                            eventCompletedProductNames = rouletteControl.eventProductData[4]
                        }
                        console.log($n, eventCompletedProductNames); //각도와 선택 상품 매칭 값.
                    },
                    eventCompleted : function (){ // 완료
                        alert("축하합니다! \n" + "["+ eventCompletedProductNames +"]에 당첨되셨습니다. \n" + "쿠폰번호 및 사용방법은 발송된 문자를 통해 확인해 주세요.");
                        rouletteControl.eventAttend = true;
                    },
                    eventPrivacyPolicy : function (e){ 
                    	if(!rouletteControl.preventDefault){ // 이벤트가 진행중이지 않을 때
	                        if($(this).is(":checked") === true){ 
	                            console.log($(this).is(":checked"));
	                            eventPrivacyPolicyCheck = true;
                                eventRouletteAllCheck = true;
	                           	
	                        } else {
	                            console.log($(this).is(":checked"));
	                            eventPrivacyPolicyCheck = false;
	                            eventRouletteAllCheck = false;
	                        }
	                    } else { // 이벤트가 진행중일 때
	                    	return;
	                    }
                    }
                };

                $(document).on("click","#eventPrivacyPolicy", rouletteControl.eventPrivacyPolicy); // 클릭 이벤트 체크박스 체크 유/무
                $(document).on("click", ".js-rotation-event", rouletteControl.event ); // 룰렛 클릭 이벤트

                rouletteControl.init(); // 처음 로드 할 필요가 없으면 선언안하셔도 됩니다.
            </script>
            

            </div>
        </div>
















    </div>
    <div class="btn02">
        <a href="https://m.tstation.com/promotion/event-list" class="btnB btnS02">목록으로</a>
    </div>
    <!-- //event list -->

</div>